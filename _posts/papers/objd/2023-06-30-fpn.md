---
layout: post
title : "[Paper Review] Feature Pyramid Networks for Object Detection (FPN, 2017)"
img: papers/objd/fpn.png
categories: [papers-objd]  
tag : [Paper Review, Object Detection, Faster R-CNN, PyTorch]
toc : true
toc_sticky : true
---

## **Outlines**
- [**Reference**](#reference)
- [**Motivation : Detecting Objects at Multiple Scales**](#motivation--detecting-objects-at-multiple-scales)
- [**Previous Works for Representing Multi-Scale Features**](#previous-works-for-representing-multi-scale-features)
- [**Feature Pyramidal Networks : Multi-Scale Features with Consistently Strong Semantics**](#feature-pyramidal-networks--multi-scale-features-with-consistently-strong-semantics)
- [**Customize PASCAL VOC Dataset**](#customize-pascal-voc-dataset)
- [**Process the Predicted Bounding Boxes from YOLO Model and Obtain Final Target Boxes**](#process-the-predicted-bounding-boxes-from-yolo-model-and-obtain-final-target-boxes)
    - [**Step 1 : Convert bounding boxes relative to cell ratio into entire image ratio**](#step-1--convert-bounding-boxes-relative-to-cell-ratio-into-entire-image-ratio)
    - [**Step 2 : Non-Maximal Suppression onto Predicted Bounding Boxes**](#step-2--non-maximal-suppression-onto-predicted-bounding-boxes)
- [**Calculate Mean Average Precison (mAP) between Predicted Boxes and Ground Truths**](#calculate-mean-average-precison-map-between-predicted-boxes-and-ground-truths)
- [**Computing Loss and Optimizing the Model**](#computing-loss-and-optimizing-the-model)
- [**Training Result & Display Predicted Anchors from Trained Model onto Image**](#training-result--display-predicted-anchors-from-trained-model-onto-image)

<br/>

## **Reference**

<br/>

- [**Feature Pyramid Networks for Object Detection, Tsung-Yi Lin, 2017**](https://arxiv.org/abs/1612.03144){:target="_blank"}
- [**FPN 논문(Feature Pyramid Networks for Object Detection) 리뷰**](https://herbwood.tistory.com/18){:target="_blank"}

<br>

## **Motivation : Detecting Objects at Multiple Scales**

<br>

- The main goal behind Feature Pyramid Networks (FPN) is to address the challenge of detecting objects at multiple scales.

- FPN introduces a pyramid-like architecture that combines features at different resolutions, better detecting objects of different sizes.


- As the model gets deeper with convolutional strides greater than 1, the resolution of feature map decreases. 

    - Decreased scale of feature map affects the performacne of model in detecting small objects. 

    - Small objects usually contain fine-grained details that cannot be precisely distinguished by small-sized feature maps due to its spatially limited resolution.

- However, each feature map obtained from deeper layer can capture higher level semantics, representing more comprehensive and complex patterns that play a critical role in object classification.

<br/>

&emsp;&emsp;&emsp;<img src="https://github.com/SuminizZ/Algorithm/assets/92680829/91300e1b-4547-411b-8fcb-d634643dfc9c" width="700">

<br/>

- Balancing this trade-off between resolution and the level of features poses a significant challenge in object detection.

<br/>

## **Previous Works for Representing Multi-Scale Features**

<br/>

&emsp; **Figure 1**

<img width="680" alt="image" src="https://github.com/SuminizZ/Algorithm/assets/92680829/a9dd420f-1557-4c28-9888-ea16b66581f7">

<br/>

- **Figure Featurized Image Pyramid : Fig. 1.(a)**

    - Use an image pyramid with multiple resolutions where each feature is computed from the corresponding image scale independently. 

    - Able to caputre multiple levels of semantics where feature representations of all levels are semantically strong. 

    - But, infeasible in terms of practical use, multiplying the amount of required computations by the number of pyramidal levels. 

    - Only can be used during test time, which will leads to semantic inconsistency between train and test phase. 

- **Single Feature Scale : Fig. 1.(b)**

    - Use a feature map with a single scale from an image (also single resolution).

    - Computationally efficient, but leads to bad performance as this approach can't properly deal with the object's scale changes.

- **Pyramidal Feature Hierarchy : Fig. 1.(c)**

    - Instead of image pyramid, build the pyramid with multiple scales of features from a single scaled image.

    - Gain output from each level of pyramid, abling to represent multi-scale features.

    - However, extracted feature map from each level contains different spatial representations that leads to large semantic gap between features from different depths.

    - Low level features gained from higher resolution maps are too general and simple, lacking sufficient representational capacity to differentiate between various objects.

    - To avoid using too low-level features, the pyramid can be adjusted to start from an intermediate level of depth.

    - But this approach can still poses a problem that higher resolution maps can't be incorporated in feature hierarchy.

<br/>

## **Feature Pyramidal Networks : Multi-Scale Features with Consistently Strong Semantics** 

<br/>

&emsp; <img width="600" alt="image" src="https://github.com/SuminizZ/Algorithm/assets/92680829/3b04fcaf-6a5e-4869-af27-da45480bac00">

<br/>

- FPN consists of
    
    - **Bottom-Up Pathway** : responsible for feed forward computations of multiple level feature maps from each stage
    
    - **Top-Down Pathway and Lateral Connections** : combine higher level maps to lower level, all from bottom-up pathway.
